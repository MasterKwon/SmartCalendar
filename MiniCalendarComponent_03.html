<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë¯¸ë‹ˆ ë‹¬ë ¥ - ì›”/ì¼ í‘œì‹œ</title>
    
    <!-- ê³µí†µ CSS íŒŒì¼ ë§í¬ -->
    <link rel="stylesheet" href="css/common.css">
    
    <!-- ê³µí†µ JavaScript íŒŒì¼ ë§í¬ -->
    <script src="js/CalendarCore.js"></script>
</head>
<body>
    <div class="mini-calendar-container">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
            <label style="display: flex; align-items: center; gap: 6px; font-size: 0.85em; color: #495057; cursor: pointer;">
                <input type="checkbox" id="fixedWeeksCheckbox" style="margin: 0;">
                <span>ë‹¬ë ¥í™•ì¥</span>
            </label>
            <button class="today-btn" id="todayBtn" title="ì˜¤ëŠ˜ë¡œ ì´ë™">ì˜¤ëŠ˜</button>
        </div>
        <div class="mini-calendar-header">
            <div class="mini-calendar-title" id="miniCalendarTitle">
                <span id="miniCalendarYearMonth">2025.06</span>
            </div>
            <div class="mini-calendar-controls">
                <button id="miniPrevBtn" title="ì´ì „">&#x2039;</button>
                <button id="miniNextBtn" title="ë‹¤ìŒ">&#x203A;</button>
            </div>
        </div>
        <div class="mini-calendar-grid" id="miniCalendarGrid">
            <!-- ìš”ì¼/ë‚ ì§œ ë™ì  ìƒì„± -->
        </div>
    </div>

    <script>
        // CalendarCore ë¡œë”© í™•ì¸ (ë™ì  ë¡œë“œ í™˜ê²½ì—ì„œë„ ì•ˆì „í•˜ê²Œ)
        if (typeof CalendarCore === 'undefined') {
            console.error('CalendarCore.js not loaded for Mini03');
            alert('CalendarCore.js íŒŒì¼ì„ ë¡œë“œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
        } else {
            console.log('âœ… CalendarCore ë¡œë”© ì„±ê³µ (Mini03):', CalendarCore);

        // ê³µí†µ ë¡œì§ ë³€ìˆ˜ë“¤ì„ ì•ˆì „í•˜ê²Œ í• ë‹¹ (prefix ì‚¬ìš©ìœ¼ë¡œ ì¶©ëŒ ë°©ì§€)
        const coreREF_DATE = CalendarCore.REFERENCE_DATE;
        const coreMINI_WEEKDAYS = CalendarCore.MINI_WEEK_DAYS;
        const coreIsAfterRef = CalendarCore.isAfterReferenceDate;
        const coreMovePrev = CalendarCore.moveToPreviousDate;
        const coreMoveNext = CalendarCore.moveToNextDate;
        const coreGet4WeekStart = CalendarCore.get4WeekStartDate;
        const coreGet4WeekDispStart = CalendarCore.get4WeekDisplayStartDate;
        const coreGet4WeekDispEnd = CalendarCore.get4WeekDisplayEndDate;
        const coreFormatRange = CalendarCore.formatDateRange;
        const coreFormatMonth = CalendarCore.formatMonthDisplay;

        let miniCurrentDate = new Date();
        let miniSelectedDate = new Date();

        function renderMiniCalendar() {
            const grid = document.getElementById('miniCalendarGrid');
            const isFixedWeeks = document.getElementById('fixedWeeksCheckbox').checked;
            grid.innerHTML = '';
            
            // ìš”ì¼ í—¤ë”
            coreMINI_WEEKDAYS.forEach((d, i) => {
                const wd = document.createElement('div');
                wd.className = 'mini-calendar-weekday';
                if (i === 5) wd.style.color = '#ef4444';
                if (i === 6) wd.style.color = '#ef4444';
                wd.textContent = d;
                grid.appendChild(wd);
            });
            
            // í˜„ì¬ ì›”/4ì£¼ ì •ë³´
            const year = miniCurrentDate.getFullYear();
            const month = miniCurrentDate.getMonth();
            const header = document.getElementById('miniCalendarYearMonth');
            const titleDiv = document.getElementById('miniCalendarTitle');
            
            if (coreIsAfterRef(miniCurrentDate)) {
                // ê³µí†µ ë¡œì§ ì‚¬ìš©
                const startDate = coreGet4WeekStart(miniCurrentDate);
                const displayStartDate = coreGet4WeekDispStart(startDate);
                const displayEndDate = coreGet4WeekDispEnd(displayStartDate);
                
                header.textContent = coreFormatRange(displayStartDate, displayEndDate);
                titleDiv.classList.add('small');
                
                // í‘œì‹œí•  ì£¼ ìˆ˜ ê³„ì‚° (4ì£¼ ë‹¬ë ¥ìš©)
                let weeksToShow = 6; // ê¸°ë³¸ 6ì£¼ (ì²«ì£¼, 4ì£¼, ë§ˆì§€ë§‰ì£¼)
                if (!isFixedWeeks) {
                    weeksToShow = 4; // ì¤‘ê°„ 4ì£¼ë§Œ í‘œì‹œ
                }
                
                const totalDays = weeksToShow === 6 ? 42 : 28;
                const startIndex = weeksToShow === 6 ? 0 : 7; // 6ì£¼ë©´ 0ë¶€í„°, 4ì£¼ë©´ 7ë¶€í„°
                
                for (let i = startIndex; i < startIndex + totalDays; i++) {
                    const d = new Date(startDate);
                    d.setDate(startDate.getDate() + i);
                    const cell = document.createElement('div');
                    cell.className = 'mini-calendar-day';
                    
                    // 6ì£¼ ëª¨ë“œì—ì„œ ì²« ì£¼(0~6), ë§ˆì§€ë§‰ ì£¼(35~41)ëŠ” ë¹„í™œì„±í™”
                    if (weeksToShow === 6 && (i < 7 || i >= 35)) {
                        cell.classList.add('disabled');
                        // ë¹„í™œì„±í™”ëœ ë‚ ì§œì—ì„œë„ ë§¤ì›” 1ì¼ì€ ì›”/ì¼ í‘œì‹œ
                        if (d.getDate() === 1) {
                            cell.innerHTML = `<span class="month-display">${d.getMonth() + 1}</span>/${d.getDate()}`;
                        } else {
                            cell.textContent = d.getDate();
                        }
                    } else {
                        // í™œì„±í™”ëœ ë‚ ì§œë“¤
                        if (d.getDay() === 6) cell.classList.add('saturday');
                        if (d.getDay() === 0) cell.classList.add('sunday');
                        const today = new Date();
                        if (d.getFullYear() === today.getFullYear() && d.getMonth() === today.getMonth() && d.getDate() === today.getDate()) {
                            cell.classList.add('today');
                        }
                        if (miniSelectedDate && d.getFullYear() === miniSelectedDate.getFullYear() && d.getMonth() === miniSelectedDate.getMonth() && d.getDate() === miniSelectedDate.getDate()) {
                            cell.classList.add('selected');
                        }
                        
                        // ëª¨ë“  ë§¤ì›” 1ì¼ì— ì›”/ì¼ í˜•ì‹ìœ¼ë¡œ í‘œì‹œ (4ì£¼/6ì£¼ êµ¬ë¶„ ì—†ì´)
                        if (d.getDate() === 1) {
                            cell.innerHTML = `<span class="month-display">${d.getMonth() + 1}</span>/${d.getDate()}`;
                        } else {
                            cell.textContent = d.getDate();
                        }
                        
                        cell.addEventListener('click', () => {
                            miniSelectedDate = new Date(d);
                            renderMiniCalendar();
                            
                            // ğŸ”— ë©”ì¸ í˜ì´ì§€ë¡œ ì„ íƒëœ ë‚ ì§œ ì „ë‹¬
                            if (typeof window.onMiniCalendarDateSelect === 'function') {
                                window.onMiniCalendarDateSelect(new Date(d));
                            }
                        });
                    }
                    grid.appendChild(cell);
                }
            } else {
                // ì›” ë‹¨ìœ„
                header.textContent = coreFormatMonth(miniCurrentDate);
                titleDiv.classList.remove('small');
                const firstDay = new Date(year, month, 1);
                const lastDay = new Date(year, month+1, 0);
                let start = new Date(firstDay);
                let firstDayOfWeek = (firstDay.getDay() + 6) % 7; // ì›”ìš”ì¼=0
                start.setDate(start.getDate() - firstDayOfWeek);
                
                // í‘œì‹œí•  ì£¼ ìˆ˜ ê³„ì‚°
                let weeksToShow = 6; // ê¸°ë³¸ 6ì£¼
                if (!isFixedWeeks) {
                    const lastDayOfWeek = (lastDay.getDay() + 6) % 7; // ì›”ìš”ì¼=0
                    const daysFromStart = firstDayOfWeek + lastDay.getDate();
                    weeksToShow = Math.ceil(daysFromStart / 7);
                }
                
                const totalDays = weeksToShow * 7;
                for (let i=0; i<totalDays; i++) {
                    const d = new Date(start);
                    d.setDate(start.getDate() + i);
                    const cell = document.createElement('div');
                    cell.className = 'mini-calendar-day';
                    if (d < firstDay || d > lastDay) {
                        cell.classList.add('other-month');
                        cell.textContent = d.getDate();
                    } else {
                        if (d.getDay() === 6) cell.classList.add('saturday');
                        if (d.getDay() === 0) cell.classList.add('sunday');
                        const today = new Date();
                        if (d.getFullYear() === today.getFullYear() && d.getMonth() === today.getMonth() && d.getDate() === today.getDate()) {
                            cell.classList.add('today');
                        }
                        if (miniSelectedDate && d.getFullYear() === miniSelectedDate.getFullYear() && d.getMonth() === miniSelectedDate.getMonth() && d.getDate() === miniSelectedDate.getDate()) {
                            cell.classList.add('selected');
                        }
                        
                        // ì›” ë‹¨ìœ„ ë‹¬ë ¥ì—ì„œëŠ” ì›”/ì¼ í‘œì‹œ ì•ˆí•¨
                        cell.textContent = d.getDate();
                        
                        cell.addEventListener('click', () => {
                            miniSelectedDate = new Date(d);
                            renderMiniCalendar();
                            
                            // ğŸ”— ë©”ì¸ í˜ì´ì§€ë¡œ ì„ íƒëœ ë‚ ì§œ ì „ë‹¬
                            if (typeof window.onMiniCalendarDateSelect === 'function') {
                                window.onMiniCalendarDateSelect(new Date(d));
                            }
                        });
                    }
                    grid.appendChild(cell);
                }
            }
        }
        
        document.getElementById('miniPrevBtn').onclick = () => {
            miniCurrentDate = coreMovePrev(miniCurrentDate);
            renderMiniCalendar();
        };
        
        document.getElementById('miniNextBtn').onclick = () => {
            miniCurrentDate = coreMoveNext(miniCurrentDate);
            renderMiniCalendar();
        };
        
        document.getElementById('todayBtn').onclick = () => {
            const today = new Date();
            miniCurrentDate = new Date(today);
            miniSelectedDate = new Date(today);
            renderMiniCalendar();
            
            // ğŸ”— ë©”ì¸ í˜ì´ì§€ë¡œ ì„ íƒëœ ë‚ ì§œ ì „ë‹¬
            if (typeof window.onMiniCalendarDateSelect === 'function') {
                window.onMiniCalendarDateSelect(new Date(today));
            }
        };
        
            document.getElementById('fixedWeeksCheckbox').addEventListener('change', () => {
                renderMiniCalendar();
            });
            
            renderMiniCalendar();
        }
    </script>

    <style>
        .month-display {
            font-size: 0.8em;
            color: #666;
            font-weight: bold;
        }
        
        .mini-calendar-day.today .month-display {
            color: white;
        }
        
        .mini-calendar-day.selected .month-display {
            color: white;
        }
        
        .mini-calendar-day.other-month .month-display {
            color: #ccc;
        }
        
        .mini-calendar-day.disabled .month-display {
            color: #999;
        }
        
        /* í† ìš”ì¼/ì¼ìš”ì¼ì¸ ë§¤ì›” 1ì¼ì˜ ì›” í‘œì‹œë„ ë¹¨ê°„ìƒ‰ìœ¼ë¡œ ì²˜ë¦¬ */
        .mini-calendar-day.saturday .month-display {
            color: #ef4444;
        }
        
        .mini-calendar-day.sunday .month-display {
            color: #ef4444;
        }
    </style>
</body>
</html> 