<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë¯¸ë‹ˆ ë‹¬ë ¥ - ì£¼ì°¨ í‘œì‹œ</title>
    
    <!-- ê³µí†µ CSS íŒŒì¼ ë§í¬ -->
    <link rel="stylesheet" href="css/common.css">
    
    <!-- ê³µí†µ JavaScript íŒŒì¼ ë§í¬ -->
    <script src="js/CalendarCore.js"></script>
</head>
<body>
    <div class="mini-calendar-container">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
            <label style="display: flex; align-items: center; gap: 6px; font-size: 0.85em; color: #495057; cursor: pointer;">
                <input type="checkbox" id="fixedWeeksCheckbox" style="margin: 0;">
                <span>ë‹¬ë ¥í™•ì¥</span>
            </label>
            <button class="today-btn" id="todayBtn" title="ì˜¤ëŠ˜ë¡œ ì´ë™">ì˜¤ëŠ˜</button>
        </div>
        <div class="mini-calendar-header">
            <div class="mini-calendar-title" id="miniCalendarTitle">
                <span id="miniCalendarYearMonth">2025.06</span>
            </div>
            <div class="mini-calendar-controls">
                <button id="miniPrevBtn" title="ì´ì „">&#x2039;</button>
                <button id="miniNextBtn" title="ë‹¤ìŒ">&#x203A;</button>
            </div>
        </div>
        <div class="mini-calendar-grid with-week-numbers" id="miniCalendarGrid">
            <!-- ìš”ì¼/ë‚ ì§œ ë™ì  ìƒì„± -->
        </div>
    </div>

    <script>
        // CalendarCore ë¡œë”© í™•ì¸ (ë™ì  ë¡œë“œ í™˜ê²½ì—ì„œë„ ì•ˆì „í•˜ê²Œ)
        if (typeof CalendarCore === 'undefined') {
            console.error('CalendarCore.js not loaded for Mini02');
            alert('CalendarCore.js íŒŒì¼ì„ ë¡œë“œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
        } else {
            console.log('âœ… CalendarCore ë¡œë”© ì„±ê³µ (Mini02):', CalendarCore);

        // ê³µí†µ ë¡œì§ ë³€ìˆ˜ë“¤ì„ ì•ˆì „í•˜ê²Œ í• ë‹¹ (prefix ì‚¬ìš©ìœ¼ë¡œ ì¶©ëŒ ë°©ì§€)
        const coreREF_DATE = CalendarCore.REFERENCE_DATE;
        const coreMINI_WEEKDAYS = CalendarCore.MINI_WEEK_DAYS;
        const coreIsAfterRef = CalendarCore.isAfterReferenceDate;
        const coreMovePrev = CalendarCore.moveToPreviousDate;
        const coreMoveNext = CalendarCore.moveToNextDate;
        const coreGet4WeekStart = CalendarCore.get4WeekStartDate;
        const coreGet4WeekDispStart = CalendarCore.get4WeekDisplayStartDate;
        const coreGet4WeekDispEnd = CalendarCore.get4WeekDisplayEndDate;
        const coreFormatRange = CalendarCore.formatDateRange;
        const coreFormatMonth = CalendarCore.formatMonthDisplay;

        let miniCurrentDate = new Date();
        let miniSelectedDate = new Date();

        // ì£¼ì°¨ ê³„ì‚° í•¨ìˆ˜ (ISO 8601 ê¸°ì¤€)
        function getWeekNumber(date) {
            const d = new Date(Date.UTC(date.getFullYear(), date.getMonth(), date.getDate()));
            const dayNum = d.getUTCDay() || 7;
            d.setUTCDate(d.getUTCDate() + 4 - dayNum);
            const yearStart = new Date(Date.UTC(d.getUTCFullYear(),0,1));
            return Math.ceil((((d - yearStart) / 86400000) + 1)/7);
        }

        function renderMiniCalendar() {
            const grid = document.getElementById('miniCalendarGrid');
            const isFixedWeeks = document.getElementById('fixedWeeksCheckbox').checked;
            grid.innerHTML = '';
            
            // ì£¼ì°¨ í—¤ë” ì¶”ê°€
            const weekHeader = document.createElement('div');
            weekHeader.className = 'mini-calendar-weekday';
            weekHeader.textContent = 'W';
            weekHeader.style.fontSize = '0.7em';
            weekHeader.style.fontWeight = 'bold';
            grid.appendChild(weekHeader);
            
            // ìš”ì¼ í—¤ë”
            coreMINI_WEEKDAYS.forEach((d, i) => {
                const wd = document.createElement('div');
                wd.className = 'mini-calendar-weekday';
                if (i === 5) wd.style.color = '#ef4444';
                if (i === 6) wd.style.color = '#ef4444';
                wd.textContent = d;
                grid.appendChild(wd);
            });
            
            // í˜„ì¬ ì›”/4ì£¼ ì •ë³´
            const year = miniCurrentDate.getFullYear();
            const month = miniCurrentDate.getMonth();
            const header = document.getElementById('miniCalendarYearMonth');
            const titleDiv = document.getElementById('miniCalendarTitle');
            
            if (coreIsAfterRef(miniCurrentDate)) {
                // ê³µí†µ ë¡œì§ ì‚¬ìš©
                const startDate = coreGet4WeekStart(miniCurrentDate);
                const displayStartDate = coreGet4WeekDispStart(startDate);
                const displayEndDate = coreGet4WeekDispEnd(displayStartDate);
                
                header.textContent = coreFormatRange(displayStartDate, displayEndDate);
                titleDiv.classList.add('small');
                
                // í‘œì‹œí•  ì£¼ ìˆ˜ ê³„ì‚° (4ì£¼ ë‹¬ë ¥ìš©)
                let weeksToShow = 6; // ê¸°ë³¸ 6ì£¼ (ì²«ì£¼, 4ì£¼, ë§ˆì§€ë§‰ì£¼)
                if (!isFixedWeeks) {
                    weeksToShow = 4; // ì¤‘ê°„ 4ì£¼ë§Œ í‘œì‹œ
                }
                
                const totalDays = weeksToShow === 6 ? 42 : 28;
                const startIndex = weeksToShow === 6 ? 0 : 7; // 6ì£¼ë©´ 0ë¶€í„°, 4ì£¼ë©´ 7ë¶€í„°
                
                for (let week = 0; week < weeksToShow; week++) {
                    // ì£¼ì°¨ í‘œì‹œ
                    const weekCell = document.createElement('div');
                    weekCell.className = 'mini-calendar-week';
                    const weekStartDate = new Date(startDate);
                    weekStartDate.setDate(startDate.getDate() + startIndex + (week * 7));
                    weekCell.textContent = getWeekNumber(weekStartDate);
                    weekCell.style.fontSize = '0.7em';
                    weekCell.style.color = '#666';
                    weekCell.style.fontWeight = 'bold';
                    grid.appendChild(weekCell);
                    
                    // í•´ë‹¹ ì£¼ì˜ ë‚ ì§œë“¤
                    for (let day = 0; day < 7; day++) {
                        const i = startIndex + (week * 7) + day;
                        const d = new Date(startDate);
                        d.setDate(startDate.getDate() + i);
                        const cell = document.createElement('div');
                        cell.className = 'mini-calendar-day';
                        
                        // 6ì£¼ ëª¨ë“œì—ì„œ ì²« ì£¼, ë§ˆì§€ë§‰ ì£¼ëŠ” ë¹„í™œì„±í™”
                        if (weeksToShow === 6 && (week === 0 || week === 5)) {
                            cell.classList.add('disabled');
                            cell.textContent = d.getDate();
                        } else {
                            // í™œì„±í™”ëœ ë‚ ì§œë“¤
                            if (d.getDay() === 6) cell.classList.add('saturday');
                            if (d.getDay() === 0) cell.classList.add('sunday');
                            const today = new Date();
                            if (d.getFullYear() === today.getFullYear() && d.getMonth() === today.getMonth() && d.getDate() === today.getDate()) {
                                cell.classList.add('today');
                            }
                            if (miniSelectedDate && d.getFullYear() === miniSelectedDate.getFullYear() && d.getMonth() === miniSelectedDate.getMonth() && d.getDate() === miniSelectedDate.getDate()) {
                                cell.classList.add('selected');
                            }
                            cell.textContent = d.getDate();
                            cell.addEventListener('click', () => {
                                miniSelectedDate = new Date(d);
                                renderMiniCalendar();
                                
                                // ğŸ”— ë©”ì¸ í˜ì´ì§€ë¡œ ì„ íƒëœ ë‚ ì§œ ì „ë‹¬
                                if (typeof window.onMiniCalendarDateSelect === 'function') {
                                    window.onMiniCalendarDateSelect(new Date(d));
                                }
                            });
                        }
                        grid.appendChild(cell);
                    }
                }
            } else {
                // ì›” ë‹¨ìœ„
                header.textContent = coreFormatMonth(miniCurrentDate);
                titleDiv.classList.remove('small');
                const firstDay = new Date(year, month, 1);
                const lastDay = new Date(year, month+1, 0);
                let start = new Date(firstDay);
                let firstDayOfWeek = (firstDay.getDay() + 6) % 7; // ì›”ìš”ì¼=0
                start.setDate(start.getDate() - firstDayOfWeek);
                
                // í‘œì‹œí•  ì£¼ ìˆ˜ ê³„ì‚°
                let weeksToShow = 6; // ê¸°ë³¸ 6ì£¼
                if (!isFixedWeeks) {
                    const lastDayOfWeek = (lastDay.getDay() + 6) % 7; // ì›”ìš”ì¼=0
                    const daysFromStart = firstDayOfWeek + lastDay.getDate();
                    weeksToShow = Math.ceil(daysFromStart / 7);
                }
                
                for (let week = 0; week < weeksToShow; week++) {
                    // ì£¼ì°¨ í‘œì‹œ
                    const weekCell = document.createElement('div');
                    weekCell.className = 'mini-calendar-week';
                    const weekStartDate = new Date(start);
                    weekStartDate.setDate(start.getDate() + (week * 7));
                    weekCell.textContent = getWeekNumber(weekStartDate);
                    weekCell.style.fontSize = '0.7em';
                    weekCell.style.color = '#666';
                    weekCell.style.fontWeight = 'bold';
                    grid.appendChild(weekCell);
                    
                    // í•´ë‹¹ ì£¼ì˜ ë‚ ì§œë“¤
                    for (let day = 0; day < 7; day++) {
                        const i = (week * 7) + day;
                        const d = new Date(start);
                        d.setDate(start.getDate() + i);
                        const cell = document.createElement('div');
                        cell.className = 'mini-calendar-day';
                        if (d < firstDay || d > lastDay) {
                            cell.classList.add('other-month');
                            cell.textContent = d.getDate();
                        } else {
                            if (d.getDay() === 6) cell.classList.add('saturday');
                            if (d.getDay() === 0) cell.classList.add('sunday');
                            const today = new Date();
                            if (d.getFullYear() === today.getFullYear() && d.getMonth() === today.getMonth() && d.getDate() === today.getDate()) {
                                cell.classList.add('today');
                            }
                            if (miniSelectedDate && d.getFullYear() === miniSelectedDate.getFullYear() && d.getMonth() === miniSelectedDate.getMonth() && d.getDate() === miniSelectedDate.getDate()) {
                                cell.classList.add('selected');
                            }
                            cell.textContent = d.getDate();
                            cell.addEventListener('click', () => {
                                miniSelectedDate = new Date(d);
                                renderMiniCalendar();
                                
                                // ğŸ”— ë©”ì¸ í˜ì´ì§€ë¡œ ì„ íƒëœ ë‚ ì§œ ì „ë‹¬
                                if (typeof window.onMiniCalendarDateSelect === 'function') {
                                    window.onMiniCalendarDateSelect(new Date(d));
                                }
                            });
                        }
                        grid.appendChild(cell);
                    }
                }
            }
        }
        
        document.getElementById('miniPrevBtn').onclick = () => {
            miniCurrentDate = coreMovePrev(miniCurrentDate);
            renderMiniCalendar();
        };
        
        document.getElementById('miniNextBtn').onclick = () => {
            miniCurrentDate = coreMoveNext(miniCurrentDate);
            renderMiniCalendar();
        };
        
        document.getElementById('todayBtn').onclick = () => {
            const today = new Date();
            miniCurrentDate = new Date(today);
            miniSelectedDate = new Date(today);
            renderMiniCalendar();
            
            // ğŸ”— ë©”ì¸ í˜ì´ì§€ë¡œ ì„ íƒëœ ë‚ ì§œ ì „ë‹¬
            if (typeof window.onMiniCalendarDateSelect === 'function') {
                window.onMiniCalendarDateSelect(new Date(today));
            }
        };
        
            document.getElementById('fixedWeeksCheckbox').addEventListener('change', () => {
                renderMiniCalendar();
            });
            
            renderMiniCalendar();
        }
    </script>
</body>
</html> 