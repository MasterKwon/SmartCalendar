<!-- ê³µí†µ CSS íŒŒì¼ ë§í¬ -->
<link rel="stylesheet" href="css/common.css">
<script>
  // ì´ë¯¸ ë¡œë“œëœ ê²½ìš° ì¤‘ë³µ ë¡œë“œ ë°©ì§€
  if (typeof window.CalendarCore === 'undefined') {
    var script1 = document.createElement('script');
    script1.src = 'js/CalendarCore.js';
    document.head.appendChild(script1);
  }
  if (typeof window.YearMonthPicker === 'undefined') {
    var script2 = document.createElement('script');
    script2.src = 'js/YearMonthPicker.js';
    document.head.appendChild(script2);
  }
</script>

<style>
    /* ë¯¸ë‹ˆë‹¬ë ¥ 4ë²ˆ ì „ìš© - ì›”ë³„ ê·¸ë£¹ ë¼ì¸ ìŠ¤íƒ€ì¼ë§ */
    .mini-calendar-grid {
        gap: 0;
    }
    
    .mini-calendar-day {
        border: 1px solid transparent;
        margin: -1px 0 0 -1px;
        border-radius: 4px;
    }
    
    /* ì›”ë³„ ê·¸ë£¹ ë¼ì¸ ìŠ¤íƒ€ì¼ë§ */
    .mini-calendar-day.month-group {
        border: 1px solid transparent;
        border-radius: 0;
    }
    
    /* ì›” ê·¸ë£¹ì˜ ê²½ê³„ì„  ê°•í™” */
    .mini-calendar-day.month-top {
        border-top: 1px solid #d1d5db;
    }
    
    .mini-calendar-day.month-bottom {
        border-bottom: 1px solid #d1d5db;
    }
    
    .mini-calendar-day.month-left {
        border-left: 1px solid #d1d5db;
    }
    
    .mini-calendar-day.month-right {
        border-right: 1px solid #d1d5db;
    }
    
    /* ì„ íƒëœ ë‚ ì§œëŠ” ì‚¬ê°í˜• ìŠ¤íƒ€ì¼ */
    .mini-calendar-day.selected {
        background: #3b82f6 !important;
        color: #fff !important;
        font-weight: 600;
        border-radius: 4px !important;
    }
    
    /* ì˜¤ëŠ˜ ë‚ ì§œëŠ” ì‚¬ê°í˜• ìŠ¤íƒ€ì¼ */
    .mini-calendar-day.today {
        background: #6366f1 !important;
        color: #fff !important;
        font-weight: 600;
        border-radius: 4px !important;
    }
    
    /* ì£¼ì°¨í‘œì‹œ ì˜ì—­ê³¼ ì¼ë°˜ë‚ ì§œ ì˜ì—­ êµ¬ë¶„ íš¨ê³¼ - Type E ì¶”ê°€ ê¸°ëŠ¥ */
    .mini-calendar-week {
        background: #f8fafc;
        border-right: 2px solid #e2e8f0;
        font-weight: 600;
        color: #475569;
    }
    
    /* ì£¼ì°¨í‘œì‹œ ì˜ì—­ì˜ í—¤ë”ë„ êµ¬ë¶„ */
    .mini-calendar-weekday:first-child {
        background: #f8fafc;
        border-right: 2px solid #e2e8f0;
        font-weight: 600;
        color: #475569;
    }
    
    .mini-calendar-weekday {
        font-size: 1em;
        font-weight: 500;
        text-align: center;
        padding: 4px 0;
    }
    
    .mini-calendar-weekday:first-child {
        font-size: 1em;
        font-weight: 500;
        text-align: center;
        background: #f8fafc;
        border-right: 2px solid #e2e8f0;
        color: #475569;
        padding: 4px 0;
    }


    .mini-calendar-container {
        position: relative;
    }

    .calendar-ym-trigger {
        display: inline-flex;
        align-items: center;
        gap: 4px;
        cursor: pointer;
    }
    .calendar-ym-icon {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        width: 18px;
        height: 18px;
        background: #3b82f6;
        border-radius: 50%;
        box-shadow: 0 2px 8px rgba(59,130,246,0.15);
        transition: background 0.18s, transform 0.18s;
        margin-left: 2px;
        transform-origin: center;
    }
    
    /* ë§¤ì›” 1ì¼ ì›”/ì¼ í‘œì‹œ ìŠ¤íƒ€ì¼ (4ì£¼ ëª¨ë“œ ì „ìš©) */
    .month-display {
        font-size: 0.8em;
        color: #666;
        font-weight: bold;
    }
    
    .mini-calendar-day.today .month-display {
        color: white;
    }
    
    .mini-calendar-day.selected .month-display {
        color: white;
    }
    
    .mini-calendar-day.other-month .month-display {
        color: #ccc;
    }
    
    .mini-calendar-day.disabled .month-display {
        color: #999;
    }
    
    /* í† ìš”ì¼/ì¼ìš”ì¼ì¸ ë§¤ì›” 1ì¼ì˜ ì›” í‘œì‹œë„ ë¹¨ê°„ìƒ‰ìœ¼ë¡œ ì²˜ë¦¬ */
    .mini-calendar-day.saturday .month-display {
        color: #ef4444;
    }
    
    .mini-calendar-day.sunday .month-display {
        color: #ef4444;
    }
</style>
    
    <div class="mini-calendar-container">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
            <label style="display: flex; align-items: center; gap: 6px; font-size: 0.85em; color: #495057; cursor: pointer;">
                <input type="checkbox" id="fixedWeeksCheckbox" style="margin: 0;">
                <span>ë‹¬ë ¥í™•ì¥</span>
            </label>
            <button class="today-btn" id="todayBtn" title="ì˜¤ëŠ˜ë¡œ ì´ë™">ì˜¤ëŠ˜</button>
        </div>
        <div class="mini-calendar-header">
            <div class="mini-calendar-title" id="miniCalendarTitle">
                <span class="calendar-ym-trigger" id="calendarYmTrigger">
                  <span class="calendar-ym-icon">
                    <svg width="12" height="12" fill="none" viewBox="0 0 12 12">
                      <path d="M4 5l2 2 2-2" stroke="#fff" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                  </span>
                  <span id="miniCalendarYearMonth">2025.06</span>
                </span>
            </div>
            <div class="mini-calendar-controls">
                <button id="miniPrevBtn" title="ì´ì „">&#x2039;</button>
                <button id="miniNextBtn" title="ë‹¤ìŒ">&#x203A;</button>
            </div>
        </div>
        <div class="mini-calendar-grid with-week-numbers" id="miniCalendarGrid">
            <!-- ìš”ì¼/ë‚ ì§œ ë™ì  ìƒì„± -->
        </div>
    </div>
    
    <script>
        // ê³µí†µ ìƒìˆ˜ë“¤ - CalendarCore.jsì—ì„œ ê°€ì ¸ì˜¤ê¸°
        const coreREF_DATE = CalendarCore.REFERENCE_DATE;
        const coreNEXT_BLOCK_DATE = CalendarCore.NEXT_BLOCK_DATE;
        const coreMINI_WEEK_DAYS = CalendarCore.MINI_WEEK_DAYS;
        const miniWeekDays = coreMINI_WEEK_DAYS; // ['M', 'T', 'W', 'T', 'F', 'S', 'S'];
        let miniCurrentDate = new Date(); // ì˜¤ëŠ˜ ë‚ ì§œë¡œ ì´ˆê¸°í™”
        let miniSelectedDate = new Date(); // ì˜¤ëŠ˜ ë‚ ì§œë¡œ ì´ˆê¸°í™”

        // CalendarCore.jsì˜ í•¨ìˆ˜ ì‚¬ìš©
        function isAfterReferenceDate(date) {
            return CalendarCore.isAfterReferenceDate(date);
        }
        // ì£¼ì°¨ ê³„ì‚° í•¨ìˆ˜ (ISO 8601 ê¸°ì¤€) - Type E ì¶”ê°€ ê¸°ëŠ¥
        function getWeekNumber(date) {
            const d = new Date(Date.UTC(date.getFullYear(), date.getMonth(), date.getDate()));
            const dayNum = d.getUTCDay() || 7;
            d.setUTCDate(d.getUTCDate() + 4 - dayNum);
            const yearStart = new Date(Date.UTC(d.getUTCFullYear(),0,1));
            return Math.ceil((((d - yearStart) / 86400000) + 1)/7);
        }
    
        function renderMiniCalendar() {
            const grid = document.getElementById('miniCalendarGrid');
            const isFixedWeeks = document.getElementById('fixedWeeksCheckbox').checked;
            grid.innerHTML = '';
            
            // ì£¼ì°¨ í—¤ë” ì¶”ê°€ - Type E ì¶”ê°€ ê¸°ëŠ¥
            const weekHeader = document.createElement('div');
            weekHeader.className = 'mini-calendar-weekday';
            weekHeader.textContent = 'W';
            grid.appendChild(weekHeader);
            
            // ìš”ì¼ í—¤ë”
            miniWeekDays.forEach((d, i) => {
                const wd = document.createElement('div');
                wd.className = 'mini-calendar-weekday';
                if (i === 5) wd.style.color = '#ef4444';
                if (i === 6) wd.style.color = '#ef4444';
                wd.textContent = d;
                grid.appendChild(wd);
            });
            // í˜„ì¬ ì›”/4ì£¼ ì •ë³´
            const year = miniCurrentDate.getFullYear();
            const month = miniCurrentDate.getMonth();
            const header = document.getElementById('miniCalendarYearMonth');
            const titleDiv = document.getElementById('miniCalendarTitle');
            
            // ê¸°ì¡´ í•˜ë“œì½”ë”© (ì£¼ì„ ì²˜ë¦¬)
            // const base = new Date(2025, 8, 1); // 2025-09-01
            // const nextBlock = new Date(base);
            // nextBlock.setDate(base.getDate() + 28); // 2025-09-29
            
            // CalendarCore.jsì˜ ìƒìˆ˜ ì‚¬ìš©
            const base = coreREF_DATE;
            const nextBlock = coreNEXT_BLOCK_DATE;
            
            if (isAfterReferenceDate(miniCurrentDate)) {
                // CalendarCore.jsì˜ 4ì£¼ ë‹¬ë ¥ ë‚ ì§œ ê³„ì‚° í•¨ìˆ˜ ì‚¬ìš©
                const startDate = CalendarCore.get4WeekStartDate(miniCurrentDate);
                const displayStartDate = CalendarCore.get4WeekDisplayStartDate(startDate);
                const displayEndDate = CalendarCore.get4WeekDisplayEndDate(displayStartDate);
                header.textContent = CalendarCore.formatDateRange(displayStartDate, displayEndDate);
                titleDiv.classList.add('small');
                
                // í‘œì‹œí•  ì£¼ ìˆ˜ ê³„ì‚° (4ì£¼ ë‹¬ë ¥ìš©)
                let weeksToShow = 6; // ê¸°ë³¸ 6ì£¼ (ì²«ì£¼, 4ì£¼, ë§ˆì§€ë§‰ì£¼)
                let totalDays = 42;
                let startIndex = 0;
                if (!isFixedWeeks) {
                    weeksToShow = 4; // ì¤‘ê°„ 4ì£¼ë§Œ í‘œì‹œ
                    totalDays = 28;
                    startIndex = 7; // 2ë²ˆì§¸ ì£¼(7ë²ˆì§¸ ì¸ë±ìŠ¤)ë¶€í„° ì‹œì‘
                }
                
                // ë‚ ì§œ ë°ì´í„° ìˆ˜ì§‘ (4ì£¼ ëª¨ë“œì¼ ë•Œ 0~27, 6ì£¼ ëª¨ë“œì¼ ë•Œ 0~41)
                const allDays = [];
                for (let i = 0; i < totalDays; i++) {
                    const d = new Date(startDate);
                    d.setDate(startDate.getDate() + startIndex + i);
                    allDays.push({
                        date: d,
                        index: i,
                        isActive: true
                    });
                }
                
                // í™œì„±í™”ëœ ë‚ ì§œë“¤ì— ì „ì²´ í™œì„± ì˜ì—­ì˜ ì™¸ê³½ ë¼ì¸ë§Œ ì ìš© - Type E ìˆ˜ì •
                const activeDays = allDays; // 4ì£¼/6ì£¼ ëª¨ë‘ ì „ë¶€ í™œì„±í™”
                
                activeDays.forEach(day => {
                    // ëª¨ë“  ë‚ ì§œì— ê¸°ë³¸ ê·¸ë£¹ ìŠ¤íƒ€ì¼ ì ìš©
                    day.hasGroupStyle = true;
                    
                    // ì „ì²´ í™œì„± ì˜ì—­ì˜ ì™¸ê³½ ë¼ì¸ë§Œ ì ìš© (ì›” ë³€ê²½ ê²½ê³„ì„  ì œê±°) - Type E ìˆ˜ì •
                    const gridIndex = day.index;
                    const dayOfWeek = (day.date.getDay() + 6) % 7; // ì›”ìš”ì¼=0
                    
                    // í™œì„± ì˜ì—­ì˜ ê²½ê³„ ì„¤ì • (ì£¼ì°¨í‘œì‹œ ì˜ì—­ í¬í•¨)
                    let topBoundary, bottomBoundary;
                    if (weeksToShow === 6) {
                        topBoundary = [7, 13];
                        bottomBoundary = [28, 34];
                    } else {
                        topBoundary = [0, 6];
                        bottomBoundary = [21, 27];
                    }
                    
                    // ë§¨ ìœ„ìª½ í–‰ì— ìƒë‹¨ ë¼ì¸ ì¶”ê°€ (ì£¼ì°¨í‘œì‹œ ì˜ì—­ê¹Œì§€ í™•ëŒ€)
                    if (gridIndex >= topBoundary[0] && gridIndex <= topBoundary[1]) {
                        day.needsTopBorder = true;
                    }
                    
                    // ë§¨ ì•„ë˜ìª½ í–‰ì— í•˜ë‹¨ ë¼ì¸ ì¶”ê°€ (ì£¼ì°¨í‘œì‹œ ì˜ì—­ê¹Œì§€ í™•ëŒ€)
                    if (gridIndex >= bottomBoundary[0] && gridIndex <= bottomBoundary[1]) {
                        day.needsBottomBorder = true;
                    }
                    
                    // ë§¨ ì™¼ìª½ ì—´ (ì›”ìš”ì¼ ìœ„ì¹˜)ì— ì¢Œì¸¡ ë¼ì¸ ì¶”ê°€
                    if (dayOfWeek === 0) {
                        day.needsLeftBorder = true;
                    }
                    
                    // ë§¨ ì˜¤ë¥¸ìª½ ì—´ (ì¼ìš”ì¼ ìœ„ì¹˜)ì— ìš°ì¸¡ ë¼ì¸ ì¶”ê°€
                    if (dayOfWeek === 6) {
                        day.needsRightBorder = true;
                    }
                });
                
                // ì‹¤ì œ DOM ìƒì„± - ì£¼ì°¨ í‘œì‹œ í¬í•¨
                for (let week = 0; week < weeksToShow; week++) {
                    // ì£¼ì°¨ í‘œì‹œ - Type E ì¶”ê°€ ê¸°ëŠ¥
                    const weekCell = document.createElement('div');
                    weekCell.className = 'mini-calendar-week';
                    const weekStartDate = new Date(startDate);
                    weekStartDate.setDate(startDate.getDate() + startIndex + (week * 7));
                    weekCell.textContent = getWeekNumber(weekStartDate);
                    weekCell.style.fontSize = '0.7em';
                    weekCell.style.color = '#666';
                    weekCell.style.fontWeight = 'bold';
                    
                    grid.appendChild(weekCell);
                    
                    // í•´ë‹¹ ì£¼ì˜ ë‚ ì§œë“¤
                    for (let day = 0; day < 7; day++) {
                        const i = (week * 7) + day;
                        const dayData = allDays[i];
                        const d = dayData.date;
                        const cell = document.createElement('div');
                        cell.className = 'mini-calendar-day';
                        
                        if (!dayData.isActive) {
                            // ì²« ì£¼(0~6), ë§ˆì§€ë§‰ ì£¼(35~41)ëŠ” ë¹„í™œì„±í™”(íšŒìƒ‰), ë‚ ì§œëŠ” í‘œì‹œ
                            cell.classList.add('disabled');
                            // ë¹„í™œì„±í™”ëœ ë‚ ì§œì—ì„œë„ ë§¤ì›” 1ì¼ì€ ì›”/ì¼ í‘œì‹œ (4ì£¼ ëª¨ë“œ ì „ìš©)
                            if (d.getDate() === 1) {
                                cell.innerHTML = `<span class="month-display">${d.getMonth() + 1}</span>/${d.getDate()}`;
                            } else {
                                cell.textContent = d.getDate();
                            }
                        } else {
                            // ê°€ìš´ë° 4ì£¼ë§Œ í™œì„±í™”
                            if (d.getDay() === 6) cell.classList.add('saturday');
                            if (d.getDay() === 0) cell.classList.add('sunday');
                            
                            const today = new Date();
                            if (d.getFullYear() === today.getFullYear() && d.getMonth() === today.getMonth() && d.getDate() === today.getDate()) {
                                cell.classList.add('today');
                            }
                            if (miniSelectedDate && d.getFullYear() === miniSelectedDate.getFullYear() && d.getMonth() === miniSelectedDate.getMonth() && d.getDate() === miniSelectedDate.getDate()) {
                                cell.classList.add('selected');
                            }
                            
                            // ì›” ê·¸ë£¹ ë¼ì¸ ìŠ¤íƒ€ì¼ ì ìš©
                            if (dayData.hasGroupStyle) {
                                cell.classList.add('month-group');
                                
                                if (dayData.needsTopBorder) cell.classList.add('month-top');
                                if (dayData.needsBottomBorder) cell.classList.add('month-bottom');
                                if (dayData.needsLeftBorder) cell.classList.add('month-left');
                                if (dayData.needsRightBorder) cell.classList.add('month-right');
                            }
                            
                            // 4ì£¼ ëª¨ë“œì—ì„œ ëª¨ë“  ë§¤ì›” 1ì¼ì— ì›”/ì¼ í˜•ì‹ìœ¼ë¡œ í‘œì‹œ
                            if (d.getDate() === 1) {
                                cell.innerHTML = `<span class="month-display">${d.getMonth() + 1}</span>/${d.getDate()}`;
                            } else {
                                cell.textContent = d.getDate();
                            }
                            
                            cell.addEventListener('click', () => {
                                miniSelectedDate = new Date(d);
                                renderMiniCalendar();
                                
                                // ğŸ”— ë©”ì¸ í˜ì´ì§€ë¡œ ì„ íƒëœ ë‚ ì§œ ì „ë‹¬
                                if (typeof window.onMiniCalendarDateSelect === 'function') {
                                    window.onMiniCalendarDateSelect(new Date(d));
                                }
                            });
                        }
                        grid.appendChild(cell);
                    }
                }
            } else {
                // ì›” ë‹¨ìœ„
                header.textContent = `${year}.${String(month+1).padStart(2,'0')}`;
                titleDiv.classList.remove('small');
                const firstDay = new Date(year, month, 1);
                const lastDay = new Date(year, month+1, 0);
                let start = new Date(firstDay);
                let firstDayOfWeek = (firstDay.getDay() + 6) % 7; // ì›”ìš”ì¼=0
                start.setDate(start.getDate() - firstDayOfWeek);
                // í‘œì‹œí•  ì£¼ ìˆ˜ ê³„ì‚°
                let weeksToShow = 6; // ê¸°ë³¸ 6ì£¼
                if (!isFixedWeeks) {
                    // í•´ë‹¹ ì›”ë§Œ í‘œì‹œí•˜ê¸° ìœ„í•œ ìµœì†Œ ì£¼ ìˆ˜ ê³„ì‚°
                    const lastDayOfWeek = (lastDay.getDay() + 6) % 7; // ì›”ìš”ì¼=0
                    const daysFromStart = firstDayOfWeek + lastDay.getDate();
                    weeksToShow = Math.ceil(daysFromStart / 7);
                }
                
                const totalDays = weeksToShow * 7;
                
                // ì¼ë°˜ ë‹¬ë ¥ ëª¨ë“œ - ì£¼ì°¨ í‘œì‹œ í¬í•¨
                for (let week = 0; week < weeksToShow; week++) {
                    // ì£¼ì°¨ í‘œì‹œ - Type E ì¶”ê°€ ê¸°ëŠ¥
                    const weekCell = document.createElement('div');
                    weekCell.className = 'mini-calendar-week';
                    const weekStartDate = new Date(start);
                    weekStartDate.setDate(start.getDate() + (week * 7));
                    weekCell.textContent = getWeekNumber(weekStartDate);
                    weekCell.style.fontSize = '0.7em';
                    weekCell.style.color = '#666';
                    weekCell.style.fontWeight = 'bold';
                    
                    grid.appendChild(weekCell);
                    
                    // í•´ë‹¹ ì£¼ì˜ ë‚ ì§œë“¤
                    for (let day = 0; day < 7; day++) {
                        const i = (week * 7) + day;
                        const d = new Date(start);
                        d.setDate(start.getDate() + i);
                        const cell = document.createElement('div');
                        cell.className = 'mini-calendar-day';
                        if (d < firstDay || d > lastDay) {
                            cell.classList.add('other-month');
                            cell.textContent = d.getDate();
                        } else {
                            if (d.getDay() === 6) cell.classList.add('saturday');
                            if (d.getDay() === 0) cell.classList.add('sunday');
                            const today = new Date();
                            if (d.getFullYear() === today.getFullYear() && d.getMonth() === today.getMonth() && d.getDate() === today.getDate()) {
                                cell.classList.add('today');
                            }
                            if (miniSelectedDate && d.getFullYear() === miniSelectedDate.getFullYear() && d.getMonth() === miniSelectedDate.getMonth() && d.getDate() === miniSelectedDate.getDate()) {
                                cell.classList.add('selected');
                            }
                            cell.textContent = d.getDate();
                            cell.addEventListener('click', () => {
                                miniSelectedDate = new Date(d);
                                renderMiniCalendar();
                                
                                // ğŸ”— ë©”ì¸ í˜ì´ì§€ë¡œ ì„ íƒëœ ë‚ ì§œ ì „ë‹¬
                                if (typeof window.onMiniCalendarDateSelect === 'function') {
                                    window.onMiniCalendarDateSelect(new Date(d));
                                }
                            });
                        }
                        grid.appendChild(cell);
                    }
                }
            }

            // ë‹¬ë ¥ í—¤ë” í´ë¦­ ì´ë²¤íŠ¸ ë°”ì¸ë”© (ë§¤ë²ˆ)
            const ymTrigger = document.getElementById('calendarYmTrigger');
            if (ymTrigger && !ymTrigger.hasAttribute('data-click-bound')) {
                ymTrigger.style.cursor = 'pointer';
                ymTrigger.addEventListener('click', function(e) {
                    console.log('[MiniCalendar] í—¤ë”(ì—°/ì›”) í´ë¦­');
                    e.stopPropagation();
                    
                    // YearMonthPicker ë¡œë”© í™•ì¸
                    if (typeof YearMonthPicker === 'undefined') {
                        console.error('[MiniCalendar] YearMonthPickerê°€ ë¡œë“œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤!');
                        alert('ë…„/ì›” ì„ íƒ ê¸°ëŠ¥ì„ ë¡œë“œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•´ì£¼ì„¸ìš”.');
                        return;
                    }
                    
                    console.log('[MiniCalendar] YearMonthPicker ì‚¬ìš©:', YearMonthPicker);
                    
                    // ê³µí†µ ëª¨ë“ˆ ì‚¬ìš©
                    YearMonthPicker.toggle({
                        container: document.querySelector('.mini-calendar-container'),
                        currentYear: miniCurrentDate.getFullYear(),
                        currentMonth: miniCurrentDate.getMonth(),
                        onSelect: (year, month) => {
                            console.log('ğŸ” YearMonthPicker onSelect í˜¸ì¶œ:', { year, month });
                            console.log('ğŸ” í˜„ì¬ ì„ íƒëœ ë‚ ì§œ:', miniSelectedDate);
                            
                            const oldSelectedDate = miniSelectedDate ? new Date(miniSelectedDate) : null;
                            console.log('ğŸ” ì´ì „ ì„ íƒëœ ë‚ ì§œ:', oldSelectedDate);
                            
                            if (year !== null) {
                                miniCurrentDate.setFullYear(year);
                            }
                            if (month !== null) {
                                miniCurrentDate.setMonth(month);
                            }
                            
                            console.log('ğŸ” ë³€ê²½ëœ í˜„ì¬ ë‚ ì§œ:', miniCurrentDate);
                            
                            // ğŸ¯ ì›” ë³€ê²½ ì‹œ ì„ íƒëœ ë‚ ì§œ ì²˜ë¦¬
                            const today = new Date();
                            const newYear = year !== null ? year : miniCurrentDate.getFullYear();
                            const newMonth = month !== null ? month : miniCurrentDate.getMonth();
                            
                            console.log('ğŸ” ìƒˆë¡œ ì´ë™í•  ë…„/ì›”:', { newYear, newMonth });
                            
                            // ğŸ¯ ê°™ì€ ë‚ ì§œ ìš°ì„  ì„ íƒ ë¡œì§
                            if (oldSelectedDate) {
                                const oldDay = oldSelectedDate.getDate();
                                const newDate = new Date(newYear, newMonth, oldDay);
                                
                                console.log('ğŸ” ê°™ì€ ë‚ ì§œ ì‹œë„:', { oldDay, newDate });
                                
                                // 4ì£¼ ë‹¬ë ¥ ëª¨ë“œì¸ì§€ í™•ì¸
                                if (isAfterReferenceDate(newDate)) {
                                    // 4ì£¼ ë‹¬ë ¥ ëª¨ë“œ: í‘œì‹œ ë²”ìœ„ ë‚´ì—ì„œ ê°™ì€ ë‚ ì§œ í™•ì¸
                                    const startDate = CalendarCore.get4WeekStartDate(miniCurrentDate);
                                    const displayStartDate = CalendarCore.get4WeekDisplayStartDate(startDate);
                                    const displayEndDate = CalendarCore.get4WeekDisplayEndDate(displayStartDate);
                                    
                                    console.log('ğŸ” 4ì£¼ ë‹¬ë ¥ í‘œì‹œ ë²”ìœ„:', { displayStartDate, displayEndDate, newDate });
                                    
                                    // ê°™ì€ ë‚ ì§œê°€ í‘œì‹œ ë²”ìœ„ì— ìˆìœ¼ë©´ ì„ íƒ, ì—†ìœ¼ë©´ ì¤‘ê°„ ë‚ ì§œ ì„ íƒ
                                    if (newDate >= displayStartDate && newDate <= displayEndDate) {
                                        miniSelectedDate = newDate;
                                        console.log('âœ… ê°™ì€ ë‚ ì§œ ì„ íƒ (4ì£¼ ë‹¬ë ¥):', newDate);
                                    } else {
                                        // í‘œì‹œ ë²”ìœ„ì˜ ì¤‘ê°„ ë‚ ì§œ ì„ íƒ
                                        const middleDate = new Date(displayStartDate);
                                        middleDate.setDate(displayStartDate.getDate() + 14);
                                        miniSelectedDate = middleDate;
                                        console.log('âœ… ì¤‘ê°„ ë‚ ì§œ ì„ íƒ (4ì£¼ ë‹¬ë ¥):', middleDate);
                                    }
                                } else {
                                    // ì¼ë°˜ ë‹¬ë ¥ ëª¨ë“œ: ê°™ì€ ë‚ ì§œê°€ ìœ íš¨í•œì§€ í™•ì¸
                                    const year = miniCurrentDate.getFullYear();
                                    const month = miniCurrentDate.getMonth();
                                    const lastDayOfMonth = new Date(year, month + 1, 0).getDate();
                                    console.log('ğŸŸ¦ [DEBUG] ì¼ë°˜ë‹¬ë ¥ oldDay:', oldDay, 'year:', year, 'month:', month + 1, 'lastDayOfMonth:', lastDayOfMonth);
                                    if (oldDay <= lastDayOfMonth) {
                                        miniSelectedDate = new Date(year, month, oldDay);
                                        console.log('âœ… ì¼ë°˜ë‹¬ë ¥: ê°™ì€ ì¼ ì„ íƒ', miniSelectedDate);
                                    } else {
                                        if (oldDay <= 15) {
                                            miniSelectedDate = new Date(year, month, 1);
                                            console.log('âœ… ì¼ë°˜ë‹¬ë ¥: ì‹œì‘ ë‚ ì§œ ì„ íƒ', miniSelectedDate);
                                        } else {
                                            miniSelectedDate = new Date(year, month, lastDayOfMonth);
                                            console.log('âœ… ì¼ë°˜ë‹¬ë ¥: ë§ˆì§€ë§‰ ë‚ ì§œ ì„ íƒ', miniSelectedDate);
                                        }
                                    }
                                }
                            } else {
                                // ì´ì „ ì„ íƒëœ ë‚ ì§œê°€ ì—†ìœ¼ë©´ ì˜¤ëŠ˜ ë˜ëŠ” 1ì¼ ì„ íƒ
                                const newDate = new Date(newYear, newMonth, 1);
                                
                                if (isAfterReferenceDate(newDate)) {
                                    // 4ì£¼ ë‹¬ë ¥ ëª¨ë“œ
                                    const startDate = CalendarCore.get4WeekStartDate(newDate);
                                    const displayStartDate = CalendarCore.get4WeekDisplayStartDate(startDate);
                                    const displayEndDate = CalendarCore.get4WeekDisplayEndDate(displayStartDate);
                                    
                                    if (today >= displayStartDate && today <= displayEndDate) {
                                        miniSelectedDate = new Date(today);
                                    } else {
                                        const middleDate = new Date(displayStartDate);
                                        middleDate.setDate(displayStartDate.getDate() + 14);
                                        miniSelectedDate = middleDate;
                                    }
                                } else {
                                    // ì¼ë°˜ ë‹¬ë ¥ ëª¨ë“œ
                                    if (today.getFullYear() === newYear && today.getMonth() === newMonth) {
                                        miniSelectedDate = new Date(today);
                                    } else {
                                        miniSelectedDate = new Date(newYear, newMonth, 1);
                                    }
                                }
                            }
                            
                            renderMiniCalendar();
                            
                            // ğŸ”— ë©”ì¸ í˜ì´ì§€ë¡œ ì„ íƒëœ ë‚ ì§œ ì „ë‹¬
                            if (typeof window.onMiniCalendarDateSelect === 'function') {
                                window.onMiniCalendarDateSelect(new Date(miniSelectedDate));
                            }
                        }
                    });
                });
                ymTrigger.setAttribute('data-click-bound', 'true');
            }
        }

function handle4WeekSelection(newDate, oldDay) {
    // 4ì£¼ ë‹¬ë ¥ ëª¨ë“œ: í‘œì‹œ ë²”ìœ„ ë‚´ì—ì„œ ê°™ì€ 'ì¼'ì´ ìˆìœ¼ë©´ ê·¸ ë‚ ì§œ, ì—†ìœ¼ë©´ ì¤‘ê°„ ë‚ ì§œ
    const startDate = CalendarCore.get4WeekStartDate(miniCurrentDate);
    const displayStartDate = CalendarCore.get4WeekDisplayStartDate(startDate);
    const displayEndDate = CalendarCore.get4WeekDisplayEndDate(displayStartDate);
    let days = [];
    let d = new Date(displayStartDate.getFullYear(), displayStartDate.getMonth(), displayStartDate.getDate());
    const end = new Date(displayEndDate.getFullYear(), displayEndDate.getMonth(), displayEndDate.getDate());
    while (d <= end) {
        days.push(new Date(d));
        d.setDate(d.getDate() + 1);
    }
    console.log('ğŸŸ¦ [DEBUG] days ë°°ì—´:', days.map(day => day.toISOString().slice(0,10)));
    console.log('ğŸŸ¦ [DEBUG] oldDay:', oldDay);
    // ê°™ì€ 'ì¼'ì´ ìˆëŠ” ë‚ ì§œ ì°¾ê¸°
    const sameDay = days.find(day => day.getDate() === oldDay);
    console.log('ğŸŸ¦ [DEBUG] sameDay:', sameDay);
    if (sameDay) {
        miniSelectedDate = sameDay;
        console.log('âœ… ê°™ì€ ì¼ ì„ íƒ (4ì£¼ ë‹¬ë ¥):', sameDay);
    } else {
        miniSelectedDate = days[Math.floor(days.length / 2)];
        console.log('âœ… ì¤‘ê°„ ë‚ ì§œ ì„ íƒ (4ì£¼ ë‹¬ë ¥):', miniSelectedDate);
    }
    console.log('ğŸŸ¦ [DEBUG] ìµœì¢… ì„ íƒëœ ë‚ ì§œ:', miniSelectedDate);
}

function moveCalendar(direction) {
    const oldSelectedDate = miniSelectedDate ? new Date(miniSelectedDate) : null;
    const oldDay = oldSelectedDate ? oldSelectedDate.getDate() : 1;
    if (direction === 'prev') {
            miniCurrentDate = CalendarCore.moveToPreviousDate(miniCurrentDate);
    } else if (direction === 'next') {
        miniCurrentDate = CalendarCore.moveToNextDate(miniCurrentDate);
    }
    const newDate = new Date(miniCurrentDate.getFullYear(), miniCurrentDate.getMonth(), oldDay);
    console.log('ğŸŸ¦ [DEBUG] ì´ë™', direction, { miniCurrentDate, oldSelectedDate, oldDay, newDate, is4Week: isAfterReferenceDate(newDate) });
    if (isAfterReferenceDate(newDate)) {
        handle4WeekSelection(newDate, oldDay);
    } else {
        // ì¼ë°˜ ë‹¬ë ¥ ëª¨ë“œ: ê°™ì€ ë‚ ì§œê°€ ìœ íš¨í•œì§€ í™•ì¸
        const year = miniCurrentDate.getFullYear();
        const month = miniCurrentDate.getMonth();
        const lastDayOfMonth = new Date(year, month + 1, 0).getDate();
        console.log('ğŸŸ¦ [DEBUG] ì¼ë°˜ë‹¬ë ¥ oldDay:', oldDay, 'year:', year, 'month:', month + 1, 'lastDayOfMonth:', lastDayOfMonth);
        if (oldDay <= lastDayOfMonth) {
            miniSelectedDate = new Date(year, month, oldDay);
            console.log('âœ… ì¼ë°˜ë‹¬ë ¥: ê°™ì€ ì¼ ì„ íƒ', miniSelectedDate);
        } else {
            // oldDayê°€ í•´ë‹¹ ì›”ì˜ ë§ˆì§€ë§‰ ë‚ ë³´ë‹¤ í¬ë©´, 15ì¼ ê¸°ì¤€ìœ¼ë¡œ ì‹œì‘/ë ë‚ ì§œ ì„ íƒ
            if (oldDay <= 15) {
                miniSelectedDate = new Date(year, month, 1);
                console.log('âœ… ì¼ë°˜ë‹¬ë ¥: ì‹œì‘ ë‚ ì§œ ì„ íƒ', miniSelectedDate);
            } else {
                miniSelectedDate = new Date(year, month, lastDayOfMonth);
                console.log('âœ… ì¼ë°˜ë‹¬ë ¥: ë§ˆì§€ë§‰ ë‚ ì§œ ì„ íƒ', miniSelectedDate);
            }
        }
    }
            renderMiniCalendar();
    // ğŸ”— ë©”ì¸ í˜ì´ì§€ë¡œ ì„ íƒëœ ë‚ ì§œ ì „ë‹¬
    if (typeof window.onMiniCalendarDateSelect === 'function') {
        window.onMiniCalendarDateSelect(new Date(miniSelectedDate));
    }
}

document.getElementById('miniPrevBtn').onclick = () => moveCalendar('prev');
document.getElementById('miniNextBtn').onclick = () => moveCalendar('next');
        // Today ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸
        document.getElementById('todayBtn').onclick = () => {
            const today = new Date();
            miniCurrentDate = new Date(today);
            miniSelectedDate = new Date(today);
            renderMiniCalendar();
            
            // ğŸ”— ë©”ì¸ í˜ì´ì§€ë¡œ ì„ íƒëœ ë‚ ì§œ ì „ë‹¬
            if (typeof window.onMiniCalendarDateSelect === 'function') {
                window.onMiniCalendarDateSelect(new Date(today));
            }
        };
        
                    // ë‹¬ë ¥í™•ì¥ ì²´í¬ë°•ìŠ¤ ë³€ê²½ ì´ë²¤íŠ¸
        document.getElementById('fixedWeeksCheckbox').addEventListener('change', () => {
            renderMiniCalendar();
        });
        
        renderMiniCalendar();
    </script> 